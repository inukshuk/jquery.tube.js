/*! jquery.tube.js 0.0.2 | https://github.com/inukshuk/jquery.tube.js/blob/master/LICENSE */
(function(a,b,c,d,e){"use strict",String.prototype.supplant||(String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d=="string"||typeof d=="number"?d:b})}),Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=a<0?this.length+a:a,this.push.apply(this,c)};var f=function(b){return b=b||{},this.on=function(c,d){return b[c]=b[c]||[],a.isFunction(d)&&b[c].push(d),this},this.once=function(a,b){var c=this;return this.on(a,function(){c.off(a,b),b.apply(c,arguments)})},this.off=function(a,c){if(b[a]){var d,e=b[a],f=[];if(c){for(d=0;d<e.length;++d)e[d]===c&&f.push(d);for(d=0;d<f;++d)e.remove(d)}else b[a]=[]}return this},this.notify=function(){var c=this,d=Array.prototype.slice.apply(arguments),e=arguments[0];return b[e]&&a.each(b[e],function(){a.isFunction(this)&&this.apply(c,d)}),this},this},g=function(b){this.statistics={},this.thumbnails=[],b&&a.extend(this,b)};g.constants={users:"//www.youtube.com/user/{name}"},g.templates={thumbnail:'<img src="{url}" title="{title}" />',title:"<h1>{title} ({duration})</h1>",author:'<a href="{author_url}">{author}</a>',description:"<p>{description}</p>",statistics:'<span class="statistics">{views} / {favorites} / {uploaded}</span>',video:'<a href="#{id}" rel="{index}">{title}{thumbnail}{description}<p>{author} – {statistics}</p></a>'},g.parameters={v:2,alt:"json-in-script",callback:"?"},g.defaults={truncate:!1,at:"\n",max:140,omission:"…",thumbnail:"mqdefault",index:0};var h=function(a,b){var c=a.length,d;return b.at&&(d=a.indexOf(b.at))>=0&&(c=Math.min(c,d)),b.max?b.omission&&c-b.omission.length>b.max?a.slice(0,b.max-b.omission.length)+b.omission:a.slice(0,Math.min(b.max,c)):a.slice(0,c)},i=function(a){return("0"+a).slice(-2)},j=function(a){return a===null?"":typeof a!="object"?a:[a.getDate(),a.getMonth(),a.getFullYear()].join(".")};g.prototype.parse=function(b){var c=this;try{b.author&&a.isArray(b.author)&&(this.author={name:b.author[0].name.$t,id:b.author[0].uri.$t.match(/\/([^\/]*)$/)[1]},this.author.url=g.constants.users.supplant(this.author)),b.yt$statistics&&(this.statistics.favorites=b.yt$statistics.favoriteCount,this.statistics.views=b.yt$statistics.viewCount),b.title&&(this.title=b.title.$t);if(b.media$group){var d=b.media$group;d.yt$videoid&&(this.id=d.yt$videoid.$t),d.media$description&&(this.description=d.media$description.$t),d.yt$duration&&(this.duration_in_seconds=parseInt(d.yt$duration.seconds,10));if(d.yt$uploaded)try{this.uploaded=new Date(Date.parse(d.yt$uploaded.$t)||Date.parse(d.yt$uploaded.$t.replace(/-/g,"/").replace(/T.*/,"")))}catch(e){}d.media$thumbnail&&a.isArray(d.media$thumbnail)&&(this.thumbnails=a.map(d.media$thumbnail,function(a){return{width:a.width,height:a.height,url:a.url,name:a.yt$name}}))}}catch(e){console.log(e)}return this},g.prototype.load=function(b,c){var d=this;return d.id=b,a.getJSON(d.request(),function(b){try{b.entry&&d.parse(b.entry),c&&a.isFunction(c)&&c.apply(d,[1,b])}catch(e){c&&a.isFunction(c)&&c.apply(d,[0,e])}}),this},g.prototype.request=function(){return[k.constants.api,"videos","/",this.id,"?",k.serialize(g.parameters)].join("")},g.prototype.seconds=function(){return(this.duration_in_seconds||0)%60},g.prototype.minutes=function(){return parseInt((this.duration_in_seconds||0)/60,10)%60},g.prototype.hours=function(){return parseInt((this.duration_in_seconds||0)/3600,10)},g.prototype.duration=function(){if(!this.duration_in_seconds)return"";var a=this.hours(),b=this.minutes(),c=this.seconds();return(a?[a,i(b),i(c)]:[b,i(c)]).join(":")},g.prototype.properties=function(b){if(typeof b.thumbnail=="string"){var c=0;a.each(this.thumbnails,function(a){if(this.name===b.thumbnail)return c=a,!1}),b.thumbnail=c}return{id:this.id,index:b.index,title:this.title,duration:this.duration(),description:b.truncate?h(this.description,b):this.description,author:this.author.name,author_url:this.author.url,views:this.statistics.views,favorites:this.statistics.favorites,uploaded:j(this.uploaded),url:this.thumbnails[b.thumbnail].url}},g.prototype.render=function(b,c){var d=this.properties(a.extend({},g.defaults,c));return b=b||g.templates,b.video.supplant({id:this.id,index:c.index,title:g.templates.title.supplant(d),thumbnail:g.templates.thumbnail.supplant(d),description:g.templates.description.supplant(d),author:g.templates.author.supplant(d),statistics:g.templates.statistics.supplant(d)})};var k=function(b){var c=this;this.videos=[],this.options=a.extend({},k.defaults,b),this.current=0,this.player=new l(this.player_options()),this.options.templates=a.extend(g.templates,this.options.templates||{}),f.apply(this),a.each(k.events,function(a,b){c.options.events[b]&&c.on(b,c.options.events[b])}),a.each(l.events,function(b,d){c.player.on(d,a.proxy(c.notify,c,d)),c.options.events[d]&&c.on(d,c.options.events[d])})};k.constants={api:"//gdata.youtube.com/feeds/api/"},k.defaults={player:"player",autoload:!1,autoplay:!1,start:0,order:"relevance",author:!1,hide:2,controls:1,version:2,format:5,limit:10,key:!1,render:!0,truncate:!1,at:"\n",max:140,omission:"…",events:[],load:!1,complete:!1,click:!1},k.parameters={q:"query","max-results":"limit",key:"key",format:"format",orderby:"order",author:"author",v:"version"},k.events=["load","ready","stop","error"],k.serialize=function(b){var c;switch(typeof b){case"string":c=encodeURI(b);break;case"object":b===null?c="":c=a.map(b,function(a,b){if(a)return[encodeURI(b),encodeURI(a)].join("=")}).join("&");break;default:c=""}return c},k.prototype.load=function(b){var c=this,d=0;return a.getJSON(this.request(),function(e){try{d=e.feed.entry.length,c.videos=a.map(e.feed.entry,function(a){return(new g).parse(a)}),d&&(c.options.autoload||c.options.start)&&(c.current=Math.min(c.videos.length-1,Math.max(0,c.options.start-1)),c.player.load(c.videos[c.current])),c.notify("load"),b&&a.isFunction(b)&&b.apply(c,[d]),c.notify("ready")}catch(f){b&&a.isFunction(b)&&b.apply(c,[0,f]),c.notify("error")}}),this},k.prototype.player_options=function(){return{id:this.options.player,playerVars:a.extend({autoplay:this.options.autoplay,autohide:this.options.hide,controls:this.options.controls},l.defaults)}},k.prototype.parameters=function(){var b=this,c={};return a.each(k.parameters,function(a,d){b.options[d]&&(c[a]=b.options[d])}),this.options.playlist?delete c.orderby:this.options.user&&(c.orderby="published"),c.alt="json-in-script",c.callback="?",c},k.prototype.request=function(b){var c=k.constants.api;return a.extend(this.options,b||{}),this.options.playlist?c+="playlists/"+this.options.playlist.replace(/^PL/,""):this.options.user?c+=["users",this.options.user,"uploads"].join("/"):c+="videos",[c,"?",k.serialize(this.parameters())].join("")},k.prototype.authenticate=function(){return this},k.prototype.play=function(b){if(a.isNumeric(b)){var c=b%this.videos.length;this.current=c<0?this.videos.length-c:c,this.player&&this.videos.length&&this.player.play(this.videos[this.current])}else this.player.resume();return this},k.prototype.pause=function(a){return this.player&&this.player.pause(),this},k.prototype.stop=function(a){return this.player&&(this.player.stop(),this.notify("stop")),this},k.prototype.next=function(){return this.advance(1).notify("next")},k.prototype.previous=function(){return this.advance(-1).notify("previous")},k.prototype.advance=function(a){return this.play(this.current+(a||1))},k.prototype.render_options=function(b){return a.extend({},g.defaults,this.options,b||{})},k.prototype.render=function(){var b=this.options.templates,c=this.render_options(),d=a.map(this.videos,function(a,d){return c.index=d,"<li>"+a.render(b,c)+"</li>"});return"<ol>"+d.join("")+"</ol>"};var l=function(b){var c=this;this.options=a.extend({},l.defaults,b),this.p=null,this.options.id=m(this.options.id),f.apply(this),this.on("state",function(b,c){var d=a.isNumeric(c)?c:c&&c.data;switch(d){case-1:this.notify("unstarted");break;case 0:this.notify("end");break;case 1:this.notify("play");break;case 2:this.notify("pause");break;case 3:this.notify("buffer");break;case 5:this.notify("cue");break;default:}}),a.each(l.events,function(a,b){c.options.events[b]&&c.on(b,c.options.events[b])}),this.once("ready",function(b){a("#"+c.options.id).data("player",c)})};l.constants={swfobject:"//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"},l.constants.events={onReady:"ready",onStateChange:"state",onPlaybackQualityChange:"quality",onError:"error"},l.defaults={id:"player",width:640,height:390,wmode:"opaque",events:{},playerVars:{autohide:2,autoplay:0,controls:1,enablejsapi:1,loop:0,modestbranding:1}},l.callbacks=[],l.semaphore=0,l.events=["unstarted","end","play","cue","buffer","pause","error"];var m=function(b){return/^#|\./.test(b)?a(b).attr("id")||b:b};l.prototype.play=function(a){return this.p?(a?(this.video=a,this.p.loadVideoById(a.id||a,0,this.options.quality)):this.p.playVideo(),this):this.load(a)},l.prototype.resume=function(){return this.p&&this.p.playVideo(),this},l.prototype.pause=function(){return this.p&&this.p.pauseVideo(),this},l.prototype.stop=function(){return this.p&&this.p.stopVideo(),this},l.prototype.seek=function(a,b){return this.p&&(e===b&&(b=!0),this.p.seekTo(a,b)),this},l.prototype.clear=function(){return this.p&&(this.p.stopVideo(),this.p.clearVideo()),this},l.prototype.current_video=function(c){var d=this.video||this.options.video;return d&&!d.id?(this.video=(new g).load(d,c),this.video):(a.isFunction(c)&&b.setTimeout(function(){c.apply(d)},0),d)},a.isFunction(b.postMessage)&&!a.browser.msie?(l.api="iframe",l.constants.api="https://www.youtube.com/player_api",l.prototype.event_proxy_for=function(b){return a.proxy(this.notify,this,b)},l.load=function(b){if(typeof YT=="undefined"){var d=c.createElement("script");return a.isFunction(b)&&l.callbacks.push(b),l.semaphore===0&&(l.semaphore=1,d.src=l.constants.api,a("script:first").before(d)),!1}return a.isFunction(b)&&setTimeout(b,0),!0},l.prototype.load=function(b){var c=this,d=a.extend({},this.options,{videoId:b.id||b,events:{}}),e=a("#"+d.id);return l.load(function(){try{e.data("player")?(c.p=e.data("player").p,a.each(l.constants.events,function(a,b){c.p.addEventListener(a,c.event_proxy_for(b))}),b&&c.p?c.play(b):c.video=b):(a.each(l.constants.events,function(a,b){d.events[a]=c.event_proxy_for(b)}),c.p=new YT.Player(d.id,d),e.data("player",c),b&&(c.video=b))}catch(f){e.append("Failed to load YouTube player: "+f.toString())}}),this},b.onYouTubePlayerAPIReady=function(){a.each(l.callbacks,function(){this.call()})}):(l.api="js",l.constants.api="//www.youtube.com/v/{video}?enablejsapi=1&playerapiid={id}&version=3",l.constants.swf_version="8",l.prototype.event_proxy_for=function(a){var c=this,d=this.options.id.replace(/[\s-]/g,"_"),e=["event_proxy_for_player",d,a].join("_");return b[e]=function(){var b=Array.prototype.slice.apply(arguments);b.unshift(a),c.notify.apply(c,b)},e},l.load=function(b){return typeof swfobject=="undefined"?(a.getScript(l.constants.swfobject,function(){a.isFunction(b)&&b.call()}),!1):(a.isFunction(b)&&setTimeout(b,0),!0)},l.prototype.load=function(b){var d=this,e=a.extend({},this.options,{videoId:b.id||b,events:{}}),f=a("#"+e.id);return l.load(function(){try{f.data("player")?(d.p=f.data("player").p,a.each(l.constants.events,function(a,b){d.p.addEventListener(a,d.event_proxy_for(b))}),b&&d.p&&d.play(b)):(l.callbacks.push(function(b){d.p=c.getElementById(b),a.each(l.constants.events,function(a,b){d.p.addEventListener(a,d.event_proxy_for(b))}),f.data("player",d)}),swfobject.embedSWF(l.constants.api.supplant({video:e.videoId,id:e.id}),e.id,e.width,e.height,l.constants.swf_version,null,e.playerVars,{allowScriptAccess:"always",wmode:"opaque"},{id:e.id}))}catch(g){console.log("Failed to load YouTube player: ",g)}}),this},b.onYouTubePlayerReady=function(){var c=arguments;a.each(l.callbacks,function(){this.apply(b,c)})}),a.fn.tube=function(b){var c,d;return this.length&&(typeof b=="string"?d={query:b}:d=b,c=this.first(),c.data("tube",(new k(d)).load(function(b){var d=this,e;b?(d.options.render&&(e=a(d.render()),a("a[rel]",e).click(function(b){a.isFunction(d.options.click)&&d.options.click.apply(d,["click",this,b]),d.play(a(this).attr("rel"))}),a.isFunction(d.options.load)&&d.options.load.apply(d,["load",e,c]),c.append(e)),a.isFunction(d.options.complete)&&d.options.complete.apply(d,["complete",e,c])):a.isFunction(d.options.complete)&&d.options.complete.apply(d,["error",e,c])}))),this},a.fn.player=function(b){var c,d,e;return this.length&&(typeof b=="string"?d=a.extend({},a.player.defaults,{video:b}):d=a.extend({},a.player.defaults,b),c=this.first(),c.data("player")?c.data.player.play(d.video):(d.id=c.attr("id"),d.video&&(new l(d)).load(d.video))),this},a.tube={},a.tube.constants=k.constants,a.tube.defaults=k.defaults,a.player={},a.player.defaults=l.defaults})(jQuery,window,window.document,"0.0.2");
